<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agenda de Sepultamentos</title>
<style>
  body { font-family: Arial, sans-serif; background: #fefefe; padding: 20px; }
  h1 { color: #333; }
  .card { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
  .livre { background-color: #d4edda; } /* verde */
  .ocupado { background-color: #f8d7da; } /* vermelho */
  button { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
  button:disabled { cursor: not-allowed; opacity: 0.6; }
</style>
</head>
<body>

<h1>Agenda de Sepultamentos</h1>
<div id="agenda"></div>

<script>
const API_KEY = "COLOQUE_SUA_API_KEY_AQUI";
const BASE_ID = "COLOQUE_SEU_BASE_ID_AQUI";
const TABLE_NAME = "Agenda de Sepultamentos";

async function fetchAgenda() {
  const res = await fetch(`https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}?view=Grid%20view`, {
    headers: { "Authorization": `Bearer ${API_KEY}` }
  });
  const data = await res.json();
  displayAgenda(data.records);
}

function displayAgenda(records) {
  const container = document.getElementById("agenda");
  container.innerHTML = "";
  records.forEach(record => {
    const { Horário, Status } = record.fields;
    const card = document.createElement("div");
    card.className = "card " + (Status === "Livre" ? "livre" : "ocupado");
    card.innerHTML = `
      <span>${Horário} - ${Status}</span>
      <button ${Status !== "Livre" ? "disabled" : ""} onclick="reservar('${record.id}')">Reservar</button>
    `;
    container.appendChild(card);
  });
}

async function reservar(recordId) {
  const falecido = prompt("Nome do Falecido:");
  if(!falecido) return alert("É necessário preencher o nome do falecido.");
  const atendente = prompt("Nome do Atendente:");
  if(!atendente) return alert("É necessário preencher o nome do atendente.");

  const body = {
    fields: {
      Falecido: falecido,
      Atendente: atendente,
      Status: "Ocupado"
    }
  };

  await fetch(`https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}/${recordId}`, {
    method: "PATCH",
    headers: {
      "Authorization": `Bearer ${API_KEY}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });

  alert("Horário reservado com sucesso!");
  fetchAgenda(); // Atualiza a lista
}

// Carrega agenda ao abrir a página
fetchAgenda();
</script>

</body>
</html>
